# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a personal Neovim configuration using Lua and the lazy.nvim plugin manager. The configuration is modularized into separate files for core settings, keymaps, and plugins, providing a clean and maintainable structure.

## Key Files & Architecture

- `init.lua`: Entry point that bootstraps lazy.nvim, loads core settings, plugins, and keymaps
- `lua/core/init.lua`: Core editor settings, autocommands, diagnostics configuration, and custom commands
- `lua/core/keymaps.lua`: All key mappings (loaded after plugins to ensure plugin functions are available)
- `lua/plugins/init.lua`: Plugin specifications with configurations
- `lazy-lock.json`: Plugin version lockfile generated by lazy.nvim

### Configuration Loading Order

1. Core settings and autocommands are loaded first (`require("core").setup()`)
2. Lazy.nvim is bootstrapped and plugins are loaded (`require("lazy").setup("plugins")`)
3. Keymaps are loaded last (`require("core.keymaps").setup()`) to ensure plugin functions are available

## Common Commands

### Neovim Operations
```bash
# Start Neovim
nvim

# Start Neovim with a specific file
nvim <filename>

# Check Neovim version
nvim --version
```

### Plugin Management
Plugins are managed through lazy.nvim. All plugin operations are done within Neovim:
- `:Lazy` - Open plugin manager interface
- `:Lazy sync` - Update plugins to match lockfile
- `:Lazy update` - Update all plugins
- `:Lazy install` - Install missing plugins

### Formatting
The configuration uses conform.nvim with automatic formatting on save:
- `<leader>F` or `<leader>f` - Manual format current buffer
- Formatters configured: gofmt (Go), stylua (Lua), prettier (JS/TS/JSON/CSS/HTML/YAML), black (Python)

Note: `stylua` formatter is referenced in the config but not currently installed on the system.

## Architecture

### Modular Structure

The configuration is split into focused modules:

- **`lua/core/init.lua`**: Contains `setup()`, `setup_autocommands()`, `setup_diagnostics()`, and `setup_commands()` functions that initialize core Neovim settings, autocommands (highlight on yank, auto-close utility windows, format on save), diagnostic signs, and custom commands (safe window close with `:Q`)
- **`lua/core/keymaps.lua`**: Contains a single `setup()` function with all keymaps organized by category (core, buffers, windows, LSP, Telescope, Neo-tree, Git, Harpoon, Illuminate, Folding, Coverage)
- **`lua/plugins/init.lua`**: Returns a table of plugin specifications where each plugin includes its own configuration

### Plugin Categories

1. **Syntax Highlighting**: nvim-treesitter with auto-installation and custom log highlighting
2. **Fuzzy Finding**: Telescope with fzf-native extension, configured to ignore common build directories
3. **LSP**: nvim-lspconfig with lua_ls, gopls, ts_ls, and pyright
4. **Autocompletion**: nvim-cmp with LSP, snippet, buffer, and path sources
5. **Formatting**: conform.nvim with auto-format on save (gofmt, stylua, prettier, black)
6. **UI Enhancements**: noice.nvim for command line, nvim-notify for notifications, nvim-scrollbar, lualine statusline, Catppuccin colorscheme
7. **File Navigation**: Neo-tree with custom system_open command, Harpoon for quick file switching
8. **Editing**: vim-illuminate for reference highlighting, nvim-ufo for folding with peek support
9. **Buffer Management**: mini.bufremove for safe buffer deletion
10. **Git**: LazyGit integration
11. **Code Coverage**: nvim-coverage with support for Python, JavaScript, TypeScript, and Go

### Key Mappings

Leader key: `<Space>`

**Core:**
- `<leader>s` - Save file
- `<leader>q` - Quit all (force)
- `<Esc>` - Clear search highlight / close floating window

**Buffers:**
- `<Tab>` / `<S-Tab>` - Next/previous buffer
- `<leader>bd` / `<leader>bD` - Delete buffer / force delete
- `<leader>ba` - Close all buffers
- `<leader>bo` - Close other buffers

**Windows:**
- `<leader>\` / `<leader>-` - Split vertically / horizontally
- `<leader>h/j/k/l` - Focus window in direction
- `<leader>w` - Close window (creates scratch buffer if last window)

**File Operations:**
- `<leader>ff` or `<leader><leader>` - Find files
- `<leader>fg` - Live grep
- `<leader>fb` - Find buffers
- `<leader>fh` - Help tags
- `<leader>fF` - Find all files (including hidden/ignored)
- `<leader>fG` - Live grep all (including hidden/ignored)
- `<leader>e` - Toggle Neo-tree file explorer

**LSP:**
- `gd` / `gr` / `gi` - Go to definition / references / implementation
- `gh` - Show diagnostics float
- `K` - Hover (or peek fold)
- `<leader>.` - Code action
- `<leader>r` - Rename symbol
- `<leader>F` - Format buffer

**Git:**
- `<leader>gg` - Open LazyGit

**Harpoon:**
- `<leader>a` - Add file to Harpoon
- `<leader>m` - Harpoon menu
- `<leader>1-5` - Jump to Harpoon file 1-5

**Reference Navigation (Illuminate):**
- `<C-n>` / `<C-p>` - Next/previous reference

**Folding (UFO):**
- `-` - Toggle fold
- `zo` / `zc` - Open/close fold recursively
- `zO` / `zC` - Open/close all folds

**Coverage:**
- `<leader>cc` - Toggle coverage display
- `<leader>cs` - Show coverage summary
- `<leader>cl` - Load/reload coverage

### LSP Configuration
Currently configured language servers:
- **lua_ls**: Lua language server with Neovim API support
- **gopls**: Go language server
- **ts_ls**: TypeScript/JavaScript language server  
- **pyright**: Python language server

All LSP servers are configured with nvim-cmp capabilities for autocompletion.

### Special Features

**Safe Window/Buffer Management:**
- The `<leader>w` keymap and `:Q` command prevent accidentally quitting Neovim when closing the last window. Instead, they create a scratch buffer.
- Buffer deletion uses mini.bufremove to preserve window layouts.
- Utility windows (help, man, qf, lspinfo, checkhealth, neo-tree, etc.) can be closed with `q`.

**Auto-formatting:**
- Format-on-save is enabled via a `BufWritePre` autocommand in `lua/core/init.lua:84-89`.
- Formatters are configured per-filetype in conform.nvim.

**Custom Log Highlighting:**
- The Treesitter config includes custom highlighting for log statements (LogDebug, LogInfo, LogWarn, LogError) in various languages, all styled as comments.

**Neo-tree System Open:**
- The `o` key in Neo-tree opens files/folders in the system file manager (Finder on macOS, xdg-open on Linux, Explorer on Windows).

**Telescope Configuration:**
- Telescope is configured to ignore common build directories (node_modules, dist, build, etc.).
- The `<leader>fF` and `<leader>fG` keymaps allow searching all files including hidden and ignored ones.

## Development Workflow

1. **Opening Files**: Use `<leader>ff` or `<leader><leader>` to fuzzy find files, `<leader>e` to browse with Neo-tree, or `<leader>a` to add frequently-used files to Harpoon
2. **Code Navigation**: Use LSP keymaps (`gd`, `gr`, `gi`) for code navigation, or `<C-n>`/`<C-p>` to jump between references of the word under cursor
3. **Searching**: Use `<leader>fg` for live grep across the project
4. **Formatting**: Code is auto-formatted on save via conform.nvim, or use `<leader>F` for manual formatting
5. **Git Operations**: Use `<leader>gg` to open LazyGit for staging, committing, and pushing
6. **Code Coverage**: Use `<leader>cl` to load coverage data, `<leader>cc` to toggle visual coverage display, and `<leader>cs` for a summary

## Plugin Dependencies

The configuration assumes certain external tools are available:
- Language servers (lua-language-server, gopls, typescript-language-server, pyright)
- Formatters (stylua, prettier, black, gofmt)
- Git and lazygit
- ripgrep (for Telescope live grep)

Most tools will be automatically installed by their respective language ecosystems or can be installed via package managers.